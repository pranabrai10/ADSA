#include <stdio.h>
#include <stdlib.h>

#define MAX 10   // Maximum number of variables and constraints

void printTable(double table[MAX][MAX], int m, int n, int basicVar[]) {
    printf("\nSimplex Tableau:\n");
    printf("----------------------------------------------------\n");
    for (int i = 0; i <= m; i++) {
        for (int j = 0; j <= n; j++) {
            printf("%8.2lf ", table[i][j]);
        }
        printf("\n");
    }
    printf("----------------------------------------------------\n");
    printf("Basic Variables: ");
    for (int i = 0; i < m; i++)
        printf("x%d ", basicVar[i] + 1);
    printf("\n");
}

int main() {
    int m, n;
    double table[MAX][MAX];
    int basicVar[MAX];
    int i, j, pivotRow, pivotCol;
    double ratio[MAX], pivot, maxZ;

    printf("Enter the number of constraints: ");
    scanf("%d", &m);
    printf("Enter the number of variables: ");
    scanf("%d", &n);

    printf("\nEnter coefficients of constraints (including RHS):\n");
    for (i = 0; i < m; i++) {
        printf("Constraint %d:\n", i + 1);
        for (j = 0; j < n; j++) {
            printf("Coefficient of x%d: ", j + 1);
            scanf("%lf", &table[i][j]);
        }
        // Slack variables
        for (j = n; j < n + m; j++)
            table[i][j] = (i == j - n) ? 1 : 0;

        printf("Right-hand side: ");
        scanf("%lf", &table[i][n + m]);
    }

    printf("\nEnter coefficients of objective function (Z = c1*x1 + c2*x2 + ...):\n");
    for (j = 0; j < n; j++) {
        printf("Coefficient of x%d: ", j + 1);
        scanf("%lf", &table[m][j]);
        table[m][j] = -table[m][j];  // For maximization
    }

    // Slack variable coefficients in Z row = 0
    for (j = n; j <= n + m; j++)
        table[m][j] = 0;

    // Initialize basic variables (slack variables)
    for (i = 0; i < m; i++)
        basicVar[i] = n + i;

    int totalVars = n + m;

    printf("\nInitial Tableau:");
    printTable(table, m, totalVars, basicVar);

    // SIMPLEX ITERATIONS
    while (1) {
        // Step 1: Find entering variable (most negative in Z-row)
        pivotCol = -1;
        maxZ = 0;
        for (j = 0; j < totalVars; j++) {
            if (table[m][j] < maxZ) {
                maxZ = table[m][j];
                pivotCol = j;
            }
        }

        // If no negative coefficient, optimal reached
        if (pivotCol == -1)
            break;

        // Step 2: Find leaving variable (minimum positive ratio)
        double minRatio = 1e9;
        pivotRow = -1;
        for (i = 0; i < m; i++) {
            if (table[i][pivotCol] > 0) {
                ratio[i] = table[i][totalVars] / table[i][pivotCol];
                if (ratio[i] < minRatio) {
                    minRatio = ratio[i];
                    pivotRow = i;
                }
            }
        }

        if (pivotRow == -1) {
            printf("\nUnbounded solution.\n");
            exit(0);
        }

        // Step 3: Pivot operation
        pivot = table[pivotRow][pivotCol];
        for (j = 0; j <= totalVars; j++)
            table[pivotRow][j] /= pivot;

        for (i = 0; i <= m; i++) {
            if (i != pivotRow) {
                double factor = table[i][pivotCol];
                for (j = 0; j <= totalVars; j++)
                    table[i][j] -= factor * table[pivotRow][j];
            }
        }

        basicVar[pivotRow] = pivotCol;

        printTable(table, m, totalVars, basicVar);
    }

    // Display result
    printf("\nOptimal Solution Found:\n");
    double result[MAX] = {0};
    for (i = 0; i < m; i++)
        result[basicVar[i]] = table[i][totalVars];

    for (j = 0; j < n; j++)
        printf("x%d = %.2lf\n", j + 1, result[j]);

    printf("Maximum Z = %.2lf\n", table[m][totalVars]);

    return 0;
}
